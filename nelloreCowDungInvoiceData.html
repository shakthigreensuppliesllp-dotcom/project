<!DOCTYPE html>
<html>

<head>
  <title>Display Invoice</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- jQuery + DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <!-- DataTables Buttons CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

  <!-- DataTables Buttons JS -->
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

  <!-- JSZip for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- pdfmake for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>


</head>

<body>
  <div id="navbarContainerId">
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Shakthi App</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Select Invoice<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="nelloreCowDungInvoice.html">Nellore - Cow Dung</a></li>
                <li><a href="warangalPaddyBalesInvoice.html">Warangal - Paddy Bales</a></li>
                <li><a href="kurnoolCowDungInvoice">Kurnool - Cow Dung</a></li>
                <li><a href="warangalCowDungInvoice.html">Warangal - Cow Dung</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Invoice Data<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Nellore - Cow Dung - Invoice Data</a></li>
                <li><a href="warangalPaddyBalesInvoiceData.html">Warangal - Paddy Bales - Invoice Data</a></li>
                <li><a href="kurnoolCowDungInvoiceData.html">Kurnool - Cow Dung - Invoice Data</a></li>
                <li><a href="warangalCowDungInvoiceData.html">Warangal - Cow Dung - Invoice Data</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Vehicle Data<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="nelloreCowDungVehicleData.html">Nellore - Cow Dung - Vehicle Data</a></li>
                <li><a href="warangalPaddyBalesVehicleData.html">Warangal - Paddy Bales - Vehicle Data</a></li>
                <li><a href="kurnoolCowDungVehicleData.html">Kurnool - Cow Dung - Vehicle Data</a></li>
                <li><a href="warangalCowDungVehicleData.html">Warangal - Cow Dung - Vehicle Data</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <a href="display.html"><button>Invoice Data</button></a>
      <br><br>
      <a href="create.html"><button>Nellore Cow Dung</button></a>
      <br><br>
      <a href="driver.html"><button>Driver Data</button></a>
    </div>
  </div>
  <div class="container">
    <h3>Select Sheet to Display</h3>
    <select id="sheetDropdown" class="form-control" style="max-width:300px;"></select>
    <br>
    <div id="tableContainer" class="table-responsive"></div>
    <br>
    <a href="home.html" class="btn btn-default">Back to Home</a>
  </div>

  <script>
    fetch('Nellore_Data.xlsx')
      .then(res => res.arrayBuffer())
      .then(buffer => {
        const workbook = XLSX.read(buffer, { type: 'array' });
        const sheetNames = workbook.SheetNames;
        const dropdown = document.getElementById('sheetDropdown');

        sheetNames.forEach(name => {
          const option = document.createElement('option');
          option.value = name;
          option.textContent = name;
          dropdown.appendChild(option);
        });

        dropdown.onchange = function () {
          const sheet = workbook.Sheets[this.value];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          const maxCols = rows[0]?.length || 0;

          let html = '<table id="excelTable" class="table table-bordered table-striped"><thead><tr>';
          for (let j = 0; j < maxCols; j++) {
            html += `<th>${rows[0][j] || ''}</th>`;
          }
          html += '</tr><tr>';
          for (let j = 0; j < maxCols; j++) {
            html += `<th><input type="text" class="form-control input-sm" placeholder="Filter" /></th>`;
          }
          html += '</tr></thead><tbody>';

          for (let i = 1; i < rows.length; i++) {
            html += '<tr>';
            for (let j = 0; j < maxCols; j++) {
              let cell = rows[i][j];

              // Format Excel date serials
              const header = rows[0][j]?.toLowerCase();

              if (typeof cell === 'number' && header && (header.includes('date') || header.includes('supply'))) {
                cell = XLSX.SSF.format("dd/mm/yyyy", cell);
              }

              if (
                header.includes('total (rs.):') ||
                header.includes('profits(rs.)') ||
                header.includes('returns(rs.)') ||
                header.includes('rnvestment(rs.)') ||
                header.includes('net qty (in mt)')
              ) {
                // Format numeric amount fields to 2 decimal places
                cell = parseFloat(cell).toFixed(2);
              }

              html += `<td>${cell || ''}</td>`;
            }
            html += '</tr>';
          }

          html += '</tbody></table>';
          document.getElementById('tableContainer').innerHTML = html;

          // Destroy previous instance
          if ($.fn.DataTable.isDataTable('#excelTable')) {
            $('#excelTable').DataTable().destroy();
          }

          // Reinitialize DataTables with column filters
          const table = $('#excelTable').DataTable({
            paging: true,
            ordering: true,
            searching: true,
            dom: 'Bfrtip',
            buttons: [
              'copyHtml5',
              'excelHtml5',
              'csvHtml5',
              'pdfHtml5',
              'print'
            ]
          });


          // Apply column filters
          $('#excelTable thead tr:eq(1) th').each(function (i) {
            $('input', this).on('keyup change', function () {
              table.column(i).search(this.value).draw();
            });
          });
        };


        dropdown.dispatchEvent(new Event('change'));
      });
  </script>


</body>

</html>