<!DOCTYPE html>
<html>
<head>
  <title>Manage JSON Data</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
</head>
<body class="p-4">
  <h2 class="mb-4">ðŸ“‹ JSON Data Table</h2>

  <table id="jsonTable" class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h4 class="mt-5">âž• Add New Row</h4>
  <form id="addForm" class="row g-3">
    <div class="col-md-4">
      <input type="text" name="name" class="form-control" placeholder="Name" required>
    </div>
    <div class="col-md-4">
      <input type="email" name="email" class="form-control" placeholder="Email" required>
    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-primary">Add & Save</button>
    </div>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script>
    let table;

    function loadData() {
      fetch('/data.json')
        .then(res => res.json())
        .then(data => {
          table.clear();
          data.forEach((row, index) => {
            table.row.add([
              `<input type="text" value="${row.name}" class="form-control name">`,
              `<input type="email" value="${row.email}" class="form-control email">`,
              `<button class="btn btn-success btn-sm save" data-index="${index}">Save</button>
               <button class="btn btn-danger btn-sm delete" data-index="${index}">Delete</button>`
            ]);
          });
          table.draw();
        });
    }

    $(document).ready(function () {
      table = $('#jsonTable').DataTable();

      loadData();

      $('#addForm').on('submit', function (e) {
        e.preventDefault();
        const name = this.name.value;
        const email = this.email.value;
        fetch('/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email })
        }).then(() => {
          this.reset();
          loadData();
        });
      });

      $('#jsonTable tbody').on('click', '.save', function () {
        const index = this.dataset.index;
        const row = $(this).closest('tr');
        const name = row.find('.name').val();
        const email = row.find('.email').val();
        fetch('/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index, name, email })
        }).then(() => loadData());
      });

      $('#jsonTable tbody').on('click', '.delete', function () {
        const index = this.dataset.index;
        fetch('/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index })
        }).then(() => loadData());
      });
    });
  </script>
</body>
</html>
